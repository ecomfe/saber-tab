<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Tab - Saber UI Demo</title>
    <link rel="stylesheet" href="demo.css">
    <script src="http://s1.bdstatic.com/r/www/cache/ecom/esl/1-6-6/esl.js"></script>
    <script>
    require.config({
        paths: {
            css: 'css'
        },
        packages: [

            {
                name: 'saber-lang',
                location: '../dep/saber-lang/src',
                main: 'main'
            },

            {
                name: 'saber-string',
                location: '../dep/saber-string/src',
                main: 'main'
            },

            {
                name: 'saber-dom',
                location: '../dep/saber-dom/src',
                main: 'main'
            },

            {
                name: 'saber-emitter',
                location: '../dep/saber-emitter/src',
                main: 'emitter'
            },

            {
                name: 'saber-ui',
                location: '../dep/saber-ui/src',
                main: 'main'
            },

            {
                name: 'saber-control',
                location: '../dep/saber-control/src',
                main: 'main'
            },

            {
                name: 'saber-button',
                location: '../dep/saber-button/src',
                main: 'button'
            },

            {
                name: 'saber-promise',
                location: '../dep/saber-promise/src',
                main: 'promise'
            },

            {
                name: 'saber-run',
                location: '../dep/saber-run/src',
                main: 'main'
            },

            {
                name: 'saber-scroll',
                location: '../dep/saber-scroll/src',
                main: 'main'
            },

            {
                name: 'saber-tap',
                location: '../dep/saber-tap/src',
                main: 'tap'
            },

            {
                name: 'saber-tab',
                location: '../src',
                main: 'tab'
            }

        ]
    });
    </script>

</head>

<body>
    <header>Tab</header>

    <div class="container">
        <h2>静态化构建</h2>
        <div id="wrapper3" class="wrapper">
            <div class="loading">初始化中...</div>
            <div data-ui="type:Button;id:menu;">分类</div>
            <div class="dropmenu dropmenu-hidden">
                <div class="menu">
                    <div data-ui="type:Tab;id:list;orientation:vertical;scroll:true;">
                        <ul data-role="navigator">
                            <li data-for="a1">教育</li>
                            <li data-for="a2">动漫</li>
                            <li data-for="a3">健康</li>
                            <li data-for="a4">生活</li>
                            <li data-for="a5">游戏</li>
                            <li data-for="a6">美女</li>
                            <li data-for="a7">汽车</li>
                            <li data-for="a8">新闻</li>
                            <li data-for="a9">话题</li>
                            <li data-for="a10">焦点</li>
                            <li data-for="a11">贴吧</li>
                            <li data-for="a12">ECOM</li>
                            <li data-for="a13">中国</li>
                            <li data-for="a14">美国</li>
                            <li data-for="a15">北京</li>
                            <li data-for="a16">百度</li>
                            <li data-for="a17">大厦</li>
                        </ul>
                    </div>
                </div>
                <div class="panel">
                    <div>
                        <div id="a1" class="ui-tab-panel">教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx</div>
                        <div id="a2" class="ui-tab-panel">动漫xxxxxxxxxxxxxxxx</div>
                        <div id="a3" class="ui-tab-panel">健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx</div>
                        <div id="a4" class="ui-tab-panel">生活xxxxxxxxxxxxxxxx</div>
                        <div id="a5" class="ui-tab-panel">游戏xxxxxxxxxxxxxxxx</div>
                        <div id="a6" class="ui-tab-panel">美女xxxxxxxxxxxxxxxx</div>
                        <div id="a7" class="ui-tab-panel">汽车xxxxxxxxxxxxxxxx</div>
                        <div id="a8" class="ui-tab-panel">新闻xxxxxxxxxxxxxxxx</div>
                        <div id="a9" class="ui-tab-panel">话题xxxxxxxxxxxxxxxx</div>
                        <div id="a10" class="ui-tab-panel">焦点xxxxxxxxxxxxxxxx</div>
                        <div id="a11" class="ui-tab-panel">贴吧xxxxxxxxxxxxxxxx</div>
                        <div id="a12" class="ui-tab-panel">ECOMxxxxxxxxxxxxxxxx</div>
                        <div id="a13" class="ui-tab-panel">中国xxxxxxxxxxxxxxxx</div>
                        <div id="a14" class="ui-tab-panel">美国xxxxxxxxxxxxxxxx</div>
                        <div id="a15" class="ui-tab-panel">北京xxxxxxxxxxxxxxxx</div>
                        <div id="a16" class="ui-tab-panel">百度xxxxxxxxxxxxxxxx</div>
                        <div id="a17" class="ui-tab-panel">大厦xxxxxxxxxxxxxxxx</div>
                    </div>
                </div>
            </div>
        </div>

        <h2>动态化创建</h2>
        <div id="wrapper4" class="wrapper"></div>
    </div>

    <script>
    require(
        [
            'saber-tap',
            'saber-dom',
            'saber-scroll',
            'saber-scroll/plugin/scrollbar',
            'saber-ui',
            'saber-button',
            'saber-tab',
            'saber-tab/plugin/scroll',
            'css!../dep/saber-button/src/button.css',
            'css!../src/tab.css'
        ],
        function( Tap, dom, Scroll, ScrollBar, ui, Button, Tab ) {
            var $ = dom.query;
            var wrapper1 = $( '#wrapper3' );
            var wrapper2 = $( '#wrapper4' );
            var dropmenu = $( '.dropmenu' );
            var initSuccess = function () {
                setTimeout(
                    function () {
                        $( '.loading' ).style.display = 'none';
                    },
                    500
                );
            };


            // 静态化
            ui.init( wrapper1, { success: initSuccess } );
            
            var menu = ui.get( 'menu' );
            var tab = ui.get( 'list' );
            var panelScroll;

            menu.onclick = function () {
                var cls = 'dropmenu-hidden';
                var isHide = dom.hasClass( dropmenu, cls );

                dom[
                    isHide ? 'removeClass' : 'addClass'
                ]( dropmenu, cls );

                // TODO: 待解耦，插件机制完成后删除
                if ( isHide && tab.scroller ) {
                    tab.scroller.repaint();
                }

                if ( isHide && !panelScroll) {
                    panelScroll = Scroll(
                        $( '.panel' ),
                        { scrollbar: true }
                    );
                }
            };

            tab.on( 'change', function () {
                if ( panelScroll ) {
                    panelScroll.repaint();
                }
            });
            tab.on( 'afterdispose', function () {
                if ( panelScroll ) {
                    panelScroll.destroy();
                    panelScroll = null;
                }
            });

            // 修复300ms点击延迟
            Tap.mixin( menu.get( 'main' ) );




            // 动态化
            var mymenu = new Button({ content: '分类' });
            mymenu.appendTo( wrapper2 );
            mymenu.onclick = function () {
                if ( !mydropmenu ) {
                    initDropMenu();
                }

                var cls = 'dropmenu-hidden';
                var isHide = dom.hasClass( mydropmenu, cls );

                dom[
                    isHide ? 'removeClass' : 'addClass'
                ]( mydropmenu, cls );

                if ( isHide && !mytab ) {
                    initDropMenuTab();
                }

                if ( isHide && !mypanelScroll ) {
                    initDropMenuPanelScroll();
                }
            };

            var mydropmenu;
            function initDropMenu() {
                mydropmenu = document.createElement( 'div' );
                mydropmenu.className = 'dropmenu dropmenu-hidden';
                mydropmenu.innerHTML = ''
                    + '<div class="menu"></div>'
                    + '<div class="panel">'
                        + '<div id="mypanel" class="ui-tab-panel"></div>'
                    + '</div>';
                wrapper2.appendChild( mydropmenu );
            }

            var mytab;
            function initDropMenuTab() {
                var tabs = tab.get( 'tabs' ).map(
                    function ( item ) {
                        return { title: item.title };
                    }
                );
                mytab = new Tab({
                    tabs: tabs,
                    scroll: true,
                    activeIndex: 2,
                    orientation: 'vertical'
                });
                mytab.on( 'change', function ( ev, data ) {
                    var panel = tab.get( 'tabs' )[ data.index ].panel;
                    $( '#mypanel' ).innerHTML = $( '#' + panel ).innerHTML;
                    if ( mypanelScroll ) {
                        mypanelScroll.repaint();
                    }
                });
                mytab.on( 'afterdispose', function () {
                    if ( mypanelScroll ) {
                        mypanelScroll.destroy();
                        mypanelScroll = null;
                    }
                });
                mytab.appendTo( mydropmenu.querySelector( '.menu' ) );
            }

            var mypanelScroll;
            function initDropMenuPanelScroll() {
                mypanelScroll = Scroll(
                    $( '#mypanel' ).parentNode,
                    { scrollbar: true }
                );
            }



            var t2 = new Tab({
                tabs: tab.get( 'tabs' ).map(function ( tab ) {
                    return { title: tab.title };
                }),
                scroll: true,
                activeIndex: 2
                // ,
                // orientation: 'vertical'
            });
            t2.appendTo( wrapper2 );
        }
    );

    document.addEventListener( 'touchstart', function(){}, false);
    </script>
</body>
</html>
